---------------------------------------
-- WM: Awesomewm		     --
-- Module: Dmenu task list           -- 
-- by Jacek Dziekonski (infiltrator) --
---------------------------------------

local awful = require("awful")

local t = {}

-- {{{ Main

-- Get current tags (table of tags)
t.tags = awful.screen.focused().selected_tags

-- Get clients from tags (table of single clients)
t.clients = {}
if t.tags ~= nil then
	for _, i in ipairs(t.tags) do
		for num, j in ipairs(i:clients()) do
		--	for k, c in ipairs(j) do
			table.insert(t.clients, j)
		--	end
		end
	end
end

-- Make a list of client names
t.client_names = {}

if t.clients ~= nil then
	for _, client in ipairs(t.clients) do
		local id = client.window
		 awful.spawn.easy_async_with_shell("xprop -id " .. id .. " | grep ^WM_NAME | awk '{print $3;}' | sed -e 's/\"//g'", function(stdout)
			table.insert(t.client_names, stdout)
		end)
	end

-- Create dmenu menu
	local list = ""
	for _, cName in ipairs(t.client_names) do
		list = list .. cName .. "\\n"
	end

	awful.spawn.with_shell("xterm -hold -e \"echo -e '" .. list .. "' \"")

end





-- }}}

return t
